@using Microsoft.Extensions.Localization
@using Microsoft.AspNetCore.Http
@inject IStringLocalizer<RolixSAEProject.SharedResource> L

<!DOCTYPE html>
<html lang="@System.Globalization.CultureInfo.CurrentUICulture.TwoLetterISOLanguageName">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - RolixSAEProject</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/RolixSAEProject.styles.css" asp-append-version="true" />
    @RenderSection("Styles", required: false)

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>

</head>
<body>
    @{
        var currentCurrency = Context.Request.Cookies["Currency"] ?? "EUR";
        var returnUrl = Context.Request.Path + Context.Request.QueryString;
        var currency = (ViewData["Currency"] as string) ?? "EUR";

        var currentLang = System.Globalization.CultureInfo.CurrentUICulture.TwoLetterISOLanguageName; // "fr" ou "en"
    }

    <header class="app-header">
        <div class="header-shell">
            <a class="brand" asp-controller="Home" asp-action="Index">ROLIX</a>

            <nav class="header-nav">
                <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Home" ? "active" : string.Empty)"
                   asp-controller="Home" asp-action="Index">@L["Nav_Home"]</a>

                <a class="nav-link @(ViewContext.RouteData.Values["controller"]?.ToString() == "Produits" ? "active" : string.Empty)"
                   asp-controller="Produits" asp-action="Index">@L["Nav_Products"]</a>

                <a class="nav-link @(ViewContext.RouteData.Values["action"]?.ToString() == "AboutUs" ? "active" : string.Empty)"
                   asp-controller="Home" asp-action="AboutUs">@L["Nav_About"]</a>
            </nav>

            <div class="header-actions">
                <div class="language-switch">
                    <a class="language @(currentLang == "fr" ? "active" : "")"
                       asp-controller="Preferences"
                       asp-action="SetLanguage"
                       asp-route-culture="fr"
                       asp-route-returnUrl="@returnUrl">FR</a>

                    <span class="divider">/</span>

                    <a class="language @(currentLang == "en" ? "active" : "")"
                       asp-controller="Preferences"
                       asp-action="SetLanguage"
                       asp-route-culture="en"
                       asp-route-returnUrl="@returnUrl">EN</a>
                </div>

                <div class="currency-switch" data-dropdown="currency">
                    <button type="button"
                            class="currency-button"
                            aria-haspopup="true"
                            aria-expanded="false"
                            aria-controls="currency-menu">
                        <span class="currency-code">@currentCurrency</span>
                        <span class="chevron" aria-hidden="true">▾</span>
                    </button>

                    <div id="currency-menu" class="currency-menu" role="menu" aria-label="@L["Currency_AriaLabel"]">
                        <a role="menuitem"
                           class="currency-item @(currentCurrency == "EUR" ? "is-active" : "")"
                           asp-controller="Preferences"
                           asp-action="SetCurrency"
                           asp-route-currency="EUR"
                           asp-route-returnUrl="@returnUrl"
                           aria-disabled="@(currentCurrency == "EUR" ? "true" : "false")"
                           tabindex="@(currentCurrency == "EUR" ? "-1" : "0")">
                            EUR <span class="currency-hint">€</span>
                        </a>

                        <a role="menuitem"
                           class="currency-item @(currentCurrency == "CHF" ? "is-active" : "")"
                           asp-controller="Preferences"
                           asp-action="SetCurrency"
                           asp-route-currency="CHF"
                           asp-route-returnUrl="@returnUrl"
                           aria-disabled="@(currentCurrency == "CHF" ? "true" : "false")"
                           tabindex="@(currentCurrency == "CHF" ? "-1" : "0")">
                            CHF <span class="currency-hint">CHF</span>
                        </a>

                        <a role="menuitem"
                           class="currency-item @(currentCurrency == "USD" ? "is-active" : "")"
                           asp-controller="Preferences"
                           asp-action="SetCurrency"
                           asp-route-currency="USD"
                           asp-route-returnUrl="@returnUrl"
                           aria-disabled="@(currentCurrency == "USD" ? "true" : "false")"
                           tabindex="@(currentCurrency == "USD" ? "-1" : "0")">
                            USD <span class="currency-hint">$</span>
                        </a>
                    </div>
                </div>

                @{
                    var isLoggedIn = !string.IsNullOrWhiteSpace(Context.Session.GetString("account_id"));
                }

                @if (!isLoggedIn)
                {
                    <a class="account-link" asp-controller="Auth" asp-action="Login">Se connecter</a>
                }
                else
                {
                    <a class="account-link" asp-controller="Account" asp-action="Index">Mon compte</a>
                }
            </div>
        </div>
    </header>

    <main role="main" class="page-wrapper">
        @RenderBody()
    </main>

    <footer class="app-footer">
        <div class="footer-shell">
            <div class="brand">ROLIX</div>
            <div class="footer-links">
                <a asp-controller="Home" asp-action="Privacy">@L["Footer_Privacy"]</a>
                <a asp-controller="Home" asp-action="Terms">@L["Footer_Terms"]</a>
                <a asp-controller="Home" asp-action="Contact">@L["Footer_Contact"]</a>
            </div>

            <p class="footer-copy">@L["Footer_Copy"]</p>
        </div>
    </footer>



    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
   
 
    <style>
        .cc-window {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            border-top: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 -12px 30px rgba(0, 0, 0, 0.35);
            padding: 14px 16px;
            line-height: 1.35;
        }

        .cc-message {
            font-size: 14px;
            max-width: 70ch;
        }

        .cc-link {
            text-decoration: underline;
            text-underline-offset: 2px;
            font-weight: 600;
        }

            .cc-link:focus-visible {
                outline: 3px solid rgba(255, 255, 255, 0.6);
                outline-offset: 3px;
                border-radius: 6px;
            }

        .cc-btn {
            border-radius: 10px;
            padding: 10px 14px;
            font-weight: 700;
            letter-spacing: 0.2px;
            border: 1px solid rgba(17, 24, 39, 0.25);
            transition: transform 0.08s ease, filter 0.15s ease, box-shadow 0.15s ease;
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.22);
        }

            .cc-btn:hover {
                filter: brightness(0.98);
            }

            .cc-btn:active {
                transform: translateY(1px);
            }

            .cc-btn:focus-visible {
                outline: 3px solid rgba(249, 250, 251, 0.55);
                outline-offset: 3px;
            }

        /* Bouton "Refuser" en style secondaire */
        .cc-deny {
            background: transparent !important;
            color: #f9fafb !important;
            border: 1px solid rgba(249, 250, 251, 0.35) !important;
            box-shadow: none !important;
        }
    </style>

    <script>
        // 1) Mets ici ce que tu veux ACTIVER uniquement après consentement
        function enableNonEssentialCookies() {
          // Exemple: activer Google Analytics / Matomo / etc.
          // -> tu mets ton code ici (et seulement ici)
          console.log("✅ Consentement OK: scripts non essentiels autorisés");
        }

        function disableNonEssentialCookies() {
          console.log("⛔ Consentement refusé: scripts non essentiels bloqués");
        }

        window.addEventListener("load", function () {
          window.cookieconsent.initialise({
            type: "opt-in", // important: rien avant acceptation
            theme: "classic",
            position: "bottom",
            palette: {
              popup: { background: "#111827", text: "#F9FAFB" }, // fond + texte
              button: { background: "#F9FAFB", text: "#111827" } // bouton principal
            },

            // Texte RGPD simple mais plus clean
            content: {
              message:
                "Nous utilisons des cookies pour mesurer l’audience et améliorer votre expérience. Vous pouvez accepter ou refuser les cookies non essentiels.",
              allow: "Accepter",
              deny: "Refuser",
              link: "Politique de cookies",
              href: "/Home/Privacy"
            },

            // 2) Opt-in réel : tu déclenches tes scripts seulement si accepté
            onInitialise: function () {
              if (this.hasConsented()) enableNonEssentialCookies();
              else disableNonEssentialCookies();
            },
            onStatusChange: function () {
              if (this.hasConsented()) enableNonEssentialCookies();
              else disableNonEssentialCookies();
            },
            onRevokeChoice: function () {
              disableNonEssentialCookies();
            }
          });
        });
    </script>



</body>
</html>
